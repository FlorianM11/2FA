version: 2
jobs:
    build:
        docker:
            - image: circleci/node:10.0-browsers
        steps:
            - checkout
            - run:
                name: "Setup Environment Variables"
                command: |
                    echo 'export TAG="0.1.${CIRCLE_BUILD_NUM}"' >> $BASH_ENV
                    echo 'export IMAGE_NAME="app-ci"' >> $BASH_ENV

            - run:
                name: "Setup custom environment variables"
                command: |
                    echo 'export MY_ENV_VAR="FOO"' >> $BASH_ENV # Redirect MY_ENV_VAR into $BASH_ENV
                    # Run a step to print what branch our code base is on.
            - run: # test what branch we're on.
                name: "What branch am I on?"
                command: echo ${CIRCLE_BRANCH}
            # Run another step, the same as above; note that you can
            # invoke environment variable without curly braces.
            - run:
                name: "What branch am I on now?"
                command: echo $CIRCLE_BRANCH
            - run:
                name: "What was my custom environment variable?"
                command: echo ${MY_ENV_VAR}

            - run:
                name: "Build and push Docker image"
                command: |
                    docker build -t silarhi/${IMAGE_NAME}:${TAG} .
                    echo ${DOCKER_PWD} | docker login -u ${DOCKER_LOGIN} --password-stdin
                    docker push silarhi/${IMAGE_NAME}:${TAG}
